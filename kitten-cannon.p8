pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
-- kitten cannon
-- by andrew edstrom

local player
local gravity = 0.4
local camera_pos
local feet_traveled
local cannon

function _init()
    player = make_player()
    cannon = make_cannon()
    feet_traveled = 0
end

function _update60()
    -- player:update()
end

function _draw()
    cls()

    camera_follow()

    map(0, 0, 0, 0, 128, 16)
    cannon:draw()
    -- player:draw()

    -- hud
    camera(0,0)
    print(flr(feet_traveled) .. "ft", 8, 8)
end

function camera_follow()
    local cam_x=max(0,player.x-60)
    camera(cam_x,0)
end

function make_cannon()
    return {
        x=13,
        y=70,
        draw=function(self)
            palt(0, false)
            palt(15, true)
            sspr(8,48,62,11,self.x,self.y)
            pal()
        end,
        update=function(self)

        end
    }
end

function make_player()
    return {
        starting_x=13,
        x=13,
        y=70,
        dx=5,
        dy=-10,
        w=26,
        h=21,
        bounce=0.8,
        on_ground=false,
        update=function(self)
            -- gravity
            self.dy = self.dy + gravity

            if hit_ground(self.x+self.dx, self.y+self.dy, self.w, self.h) then
                self.dy = self.dy * -self.bounce
                if abs(self.dy) < 1.8 then
                    self.on_ground=true
                end

                self.dx = self.dx*0.9
            end

            if self.on_ground then
                self.y = 103-self.h

            else
                self.y = self.y + self.dy
                feet_traveled += self.dx / 8
                self.x = self.x + self.dx
            end

            -- infinite scrolling
            local halfway_through_second_to_last_map_screen = 104
            if self.x >= halfway_through_second_to_last_map_screen*8 then
                local how_far_over = self.x-(halfway_through_second_to_last_map_screen*8)
                self.x = 24*8 + how_far_over
            end
        end,
        draw=function(self)
            palt(0, false)
            palt(15, true)
            sspr(8, 0, self.w+1, self.h+1, self.x, self.y)
            -- rect(self.x, self.y, self.x+self.w, self.y+self.h, rect_col)

            pal()
        end
    }
end

--todo just move to player
function hit_ground(x,y,w,h)
    local i

    for i=x, x+w do
        local top_edge_cell = mget(i/8, y/8)
        local bottom_edge_cell = mget(i/8, (y+h)/8)
        if fget(top_edge_cell, 1) or fget(bottom_edge_cell, 1) then
            return true
        end
    end

    for i=y, y+h do
        local left_edge_cell = mget(x/8, i/8)
        local right_edge_cell = mget((x+w)/8, i/8)
        if fget(left_edge_cell, 1) or fget(right_edge_cell, 1) then
            return true
        end
    end

    return false
end

__gfx__
00000000ffdd6fffffffffffffffffffffffffffccccccccccccccccccccccccccccccccbbbbbbbb000000000000000000000000000000000000000000000000
00000000fd666fffffffffffffffffffffffffffcccbcccccccccccccccccccccccccccc33333333000000000000000000000000000000000000000000000000
00700700fd666fffffffffffffffffffffffffffcccbcccccccccc3bcbcccccccccccccc33333333000000000000000000000000000000000000000000000000
00077000d666ffffffffffffffffffffffffffffcc3b3cb3ccb3cb3bcb3cccbccccbcc3c33333333000000000000000000000000000000000000000000000000
00077000d6ffffffffffffffdfffffdfffffffffbc3b3c3bc3b3cbbb3b3cccb3cbccbc3b33323322000000000000000000000000000000000000000000000000
00700700d6fffffffffffffd5ddffd5dffffffffb33b3b3bbbb3bbbbbb3cccb3cbccb33b33223222000000000000000000000000000000000000000000000000
00000000d6fffffffffffffd5666666dffffffffb3bb3b3bbbbbbbbbbbbcc3bbbbb3b33b32422442000000000000000000000000000000000000000000000000
00000000d6ffffffffffffd666666666ffffffffbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb24444442000000000000000000000000000000000000000000000000
00000000d666ffffffff000666066606600fffffccccccccccccccccccccccccbbbbbbbb44444444444444444444444400000000000000000000000000000000
00000000fd66ffffffffffd6660666066fffffffccccccccccccccccccccccccbbbbbbbb44444444444444444246442400000000000000000000000000000000
00000000fd66ffffffff000666660666600fffffcbccccccccccccccccccccccbbbbbbbb444444444424424444666d4400000000000000000000000000000000
00000000fd666fffffffffd66660e0666fffffffcb3cccbccccbcc3cccccccccbbbbbbbb4444444442442444444d66d400000000000000000000000000000000
00000000ffdd66666666666d666666666fffffff3b3cccb3cbccbc3bccccccccbbbbbbbb44444444444244444424d64400000000000000000000000000000000
00000000ffffd66666666666d6666666ffffffffbb3cccb3cbccb33bccccccccbbbbbbbb44444444442444444444444400000000000000000000000000000000
00000000fffffd66666666666666666fffffffffbbbcc3bbbbb3b33bccccccccbbbbbbbb44444444444444444444442400000000000000000000000000000000
00000000fffffd66666666666666766fffffffffbbbbbbbbbbbbbbbbccccccccbbbbbbbb44444444444444444444444400000000000000000000000000000000
00000000fffffd66666666666667776fffffffff0000000000000000000000000000000000000000bb0b00000000000000000000000000000000000000000000
00000000ffffd666666666666777775fffffffff00000000000000000000000000000000000000000b3b00000000000000000000000000000000000000000000
00000000ffffd66666666666677775ffffffffff0000000000000000000000000000000000000000003b00000000000000000000000000000000000000000000
00000000ffffd66dddddddd6655556ffffffffff0000000000000000000000000000000000000000000b0bb00000000000000000000000000000000000000000
00000000ffffd6f55ffffffd6fffd6ffffffffff0000000000000000000000000000000000000000000b3b000000000000000000000000000000000000000000
00000000ffffdff5ffffffff6fffdfffffffffff0000000000000000000000000000000000000000000b30000000000000000000000000000000000000000000
00000000ffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000b00000000000000000000000000000000000000000000
00000000ffdd6fffffffffffffffffffffffffff0000000000000000000000000000000000000000000b00000000000000000000000000000000000000000000
00000000fd666ffffffffffffffffffffff000000000000000000000000000000000000044444444444444440000000000000000000000000000000000000000
00000000fd666ffffffffffffffffffffff00000000000000000000000000000000000004466444444d664440000000000000000000000000000000000000000
00000000d666fffffffffffffffffffffff000000000000000000000000000000000000042d6744442dd67440000000000000000000000000000000000000000
00000000d6ffffffffffffffdfffffdffff000000000000000000000000000000000000022dd664422dd66440000000000000000000000000000000000000000
00000000d6fffffffffffffd5ddffd5dfff000000000000000000000000000000000000022ddd66422dd66440000000000000000000000000000000000000000
00000000d6fffffffffffffd5666666dfff000000000000000000000000000000000000022dddd6422dddd440000000000000000000000000000000000000000
00000000d6ffffffffffffd666666666fff000000000000000000000000000000000000022222244422222440000000000000000000000000000000000000000
00000000d666ffffffff000666066606600000000000000000000000000000000000000044444444444444440000000000000000000000000000000000000000
00000000fd66ffffffffffd6660666066ff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000fd66ffffffff000666660666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000fd666fffffffffd66660e0666ff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ffdd66666666666d666666666ff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ffffd66666666666d6666666fff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000fffffd66666666666666666ffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000fffffd66666666666666766ffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000fffffd66666666666667776ffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ffffd666666666666777775ffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ffffd66666666666677775fffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ffffd66dddddddd6655556fffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ffffd6f55ffffffd6fffd6fffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ffffdff5ffffffff6fffdffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000ffffffffffffffffffffffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000
00000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000
00000000ffff555555555555555555550fffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000
00000000ffffddddddddddddddddddddd05555555555555550ffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000
00000000ffff66666666666666666666660ddddddddddddddd055555555555555550ffffffffffffff0000000000000000000000000000000000000000000000
00000000ffff6666666666666666666666066666666666666660dddddddddddddddd0fffffffffffff0000000000000000000000000000000000000000000000
00000000ffff6666666666666666666666066666666666666660666666666666666660ffffffffffff0000000000000000000000000000000000000000000000
00000000ffff6666666666666666666666066666666666666660666666666666666660ffffffffffff0000000000000000000000000000000000000000000000
00000000ffff6666666666666666666666066666666666666660dddddddddddddddd0fffffffffffff0000000000000000000000000000000000000000000000
00000000ffff66666666666666666666660ddddddddddddddd055555555555555550ffffffffffffff0000000000000000000000000000000000000000000000
00000000ffffddddddddddddddddddddd05555555555555550ffffffffffffffffffffffffffffffffffffffffffffffffffffff000000000000000000000000
00000000ffff555555555555555555550fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff000000000000000000000000
00000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000200000000000000000000000000000002020200000000000000000000000000020000000000000000000000000000000202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717
1717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717
1717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717
1717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717
1717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717
1717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717
1717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717
1717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717
1717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717
1717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717
1717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717
1717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717
1717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717
0909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909
1a1b191919193a1919391919191a19191a19191a19193a1919391919191a19191a3919191a193a1919391919191a19191a1b191919193a1919391919191a1a1b191919193a1919391919191a1b1919191a1b191919193a1919391919191a19191a19191a19193a1919391919191a19191a3919191a193a1919391919191a1919
19193a191a19191919191a191939191a19193a191a19191919191a191939191919193a191a19191919191a191939191919193a191a19191919191a19193919193a191a19191919191a191919193a191a19193a191a19191919191a191939191a19193a191a19191919191a191939191919193a191a19191919191a1919391919
